<dialog id="my_modal_3" class="modal">
  <div class="modal-box max-w-3xl">
    <form method="dialog">
      <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button>
    </form>

    <!-- Header -->
    <div class="flex items-center gap-3 mb-4">
      <lucide-icon [img]="ShoppingBag" class="w-6 h-6 text-primary"></lucide-icon>
      <h3 class="text-2xl font-bold">Shopping Cart</h3>
      <span class="badge badge-primary">{{ itemCount }} items</span>
    </div>

    <div class="py-4">
      @if (cartItems().length === 0) {
        <div class="text-center py-12">
          <lucide-icon
            [img]="ShoppingBag"
            class="w-16 h-16 text-base-content/20 mx-auto mb-4"
          ></lucide-icon>
          <p class="text-lg text-base-content/60 mb-2">Your cart is empty</p>
          <p class="text-sm text-base-content/40">Add some products to get started!</p>
        </div>
      } @else {
        <!-- Cart Items -->
        <div class="flex flex-col gap-3 max-h-96 overflow-y-auto pr-2">
          @for (item of cartItems(); track item.product.id; let i = $index) {
            <div
              class="flex items-start gap-4 p-4 border border-base-300 rounded-lg hover:border-primary/50 transition-colors"
            >
              <!-- Product Image -->
              <img
                [src]="item.product.imageUrl"
                [alt]="item.product.name"
                class="w-20 h-20 object-cover rounded-lg"
              />

              <!-- Product Details -->
              <div class="flex-1 min-w-0">
                <h4 class="font-semibold text-base mb-1 truncate">{{ item.product.name }}</h4>
                <p class="text-sm text-base-content/70 mb-2">
                  ${{ item.product.price.toFixed(2) }} each
                </p>

                <!-- Stock Info -->
                <div class="flex items-center gap-2 mb-2">
                  @if (item.product.quantity > 10) {
                    <span class="badge badge-success badge-xs">In Stock</span>
                  } @else if (item.product.quantity > 0) {
                    <span class="badge badge-warning badge-xs"
                      >Only {{ item.product.quantity }} left</span
                    >
                  } @else {
                    <span class="badge badge-error badge-xs">Out of Stock</span>
                  }
                </div>

                <!-- Quantity Controls -->
                <div class="flex items-center gap-3">
                  <span class="text-xs text-base-content/60 font-medium">Quantity:</span>
                  <div class="join space-x-2">
                    <button
                      (click)="decreaseQuantity(item)"
                      [disabled]="item.quantity <= 1"
                      class="btn btn-xs join-item btn-outline"
                      title="Decrease quantity"
                    >
                      <lucide-icon [img]="Minus" class="w-3 h-3"></lucide-icon>
                    </button>
                    <span class="btn btn-xs join-item no-animation font-semibold min-w-[3rem]">{{
                      item.quantity
                    }}</span>
                    <button
                      (click)="increaseQuantity(item)"
                      [disabled]="!canIncreaseQuantity(item)"
                      class="btn btn-xs join-item btn-outline"
                      [title]="
                        canIncreaseQuantity(item) ? 'Increase quantity' : 'Max stock reached'
                      "
                    >
                      <lucide-icon [img]="Plus" class="w-3 h-3"></lucide-icon>
                    </button>
                  </div>

                  @if (!canIncreaseQuantity(item)) {
                    <span class="text-xs text-warning">Max</span>
                  }
                </div>
              </div>

              <!-- Price & Remove -->
              <div class="flex flex-col items-end gap-2">
                <span class="font-bold text-lg text-primary"
                  >${{ (item.product.price * item.quantity).toFixed(2) }}</span
                >
                <button
                  (click)="removeItem(i)"
                  class="btn btn-xs btn-ghost text-error hover:bg-error/10"
                  title="Remove from cart"
                >
                  <lucide-icon [img]="Trash2" class="w-4 h-4"></lucide-icon>
                </button>
              </div>
            </div>
          }
        </div>

        <!-- Cart Summary -->
        <div class="mt-6 pt-4 border-t border-base-300">
          <div class="flex justify-between items-center mb-4">
            <span class="text-base-content/70">Subtotal ({{ itemCount }} items):</span>
            <span class="text-lg font-semibold">${{ total.toFixed(2) }}</span>
          </div>
          <div class="flex justify-between items-center mb-6 text-xl font-bold">
            <span>Total:</span>
            <span class="text-primary">${{ total.toFixed(2) }}</span>
          </div>

          <!-- Action Buttons -->
          <div class="flex gap-3">
            <form method="dialog" class="flex-1">
              <button class="btn btn-outline w-full">Continue Shopping</button>
            </form>
            <button class="btn btn-primary flex-1">
              <lucide-icon [img]="ShoppingBag" class="w-5 h-5"></lucide-icon>
              Checkout
            </button>
          </div>
        </div>
      }
    </div>
  </div>
</dialog>
